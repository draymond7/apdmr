apt install -y hostapd dnsmasq nftables

sudo systemctl daemon-reload
sudo systemctl enable hotspot.service
sudo systemctl start hotspot.service


============
python3 /path/to/setup_hotspot.py
setup_hotspot.py:
============
import os
import subprocess

# Function to write file content
def write_file(path, content):
    with open(path, 'w') as file:
        file.write(content)

# Define the content for the systemd service file
service_file_content = '''
[Unit]
Description=Hotspot Service
After=network.target

[Service]
Type=oneshot
RemainAfterExit=yes
ExecStart=/root/start_hotspot.sh
ExecStop=/usr/sbin/hostapd -B -s

[Install]
WantedBy=multi-user.target
'''

# Define the content for the executable bash script
script_content = '''#!/bin/bash

# Bring up the wireless interface
ip link set wlan0 up

# Assign a static IPs to wlan0, eth1
ip addr add 10.10.9.1/24 dev wlan0
ip addr add 10.10.8.1/24 dev eth1

# Enable IP forwarding
sysctl -w net.ipv4.ip_forward=1

# Configure nftables for NAT
nft add table nat
nft 'add chain nat prerouting { type nat hook prerouting priority -100 ; }'
nft 'add chain nat postrouting { type nat hook postrouting priority 100 ; }'
nft add rule nat postrouting oifname "eth0" masquerade
nft add rule nat postrouting oifname "wlan0" masquerade

# Start hostapd with logging
/usr/sbin/hostapd -B -d -f /var/log/hostapd.log /etc/hostapd/hostapd.conf

# Start dnsmasq with logging for both interfaces
/usr/sbin/dnsmasq --interface=wlan0 --dhcp-range=10.10.9.64,10.10.9.99,12h --interface=eth1 --dhcp-range=10.10.8.64,10.10.8.99,12h -l /root/dnsmasq.log
'''

# Write the service file
write_file('/etc/systemd/system/hotspot.service', service_file_content)

# Write the script file
write_file('/root/start_hotspot.sh', script_content)

# Set the executable permissions on the bash script
os.chmod('/root/start_hotspot.sh', 0o755)

# Reload systemd to recognize the new service
subprocess.run(['sudo', 'systemctl', 'daemon-reload'], check=True)

# Enable and start the service
subprocess.run(['sudo', 'systemctl', 'enable', 'hotspot.service'], check=True)
subprocess.run(['sudo', 'systemctl', 'start', 'hotspot.service'], check=True)

